
<launch>

  <node name="rosconsole_overlay_text"
        pkg="jsk_rviz_plugins" type="rosconsole_overlay_text.py">
    <rosparam>
      nodes:
      - /robotassembler
    </rosparam>
  </node>
  <node name="rviz"
        pkg="rviz" type="rviz"
        args="-d $(find robot_assembler)/test/robot_assembler.rviz">
  </node>
  

  <!-- rgb color filter -->
  <group ns="rgbcolorfilter">
    <arg name="RGB_INPUT_CLOUD" value="/depth_camera/points" />

    <!--Extracting gazebo blue obj -->
    <!-- <arg name="r_max" default="116" /> -->
    <!-- <arg name="r_min" default="63" /> -->
    <!-- <arg name="g_max" default="31" /> -->
    <!-- <arg name="g_min" default="0" /> -->
    <!-- <arg name="b_max" default="18" /> -->
    <!-- <arg name="b_min" default="0" /> -->

    <!--Extracting gazebo green cylinder obj -->
    <arg name="r_max" default="0" />
    <arg name="r_min" default="0" />
    <arg name="g_max" default="255" />
    <arg name="g_min" default="0" />
    <arg name="b_max" default="0" />
    <arg name="b_min" default="0" />


    <node name="rgb_filter_manager"
          pkg="nodelet" type="nodelet"
          args="manager"/>

    <node name="rgb_color_filter"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/RGBColorFilter rgb_filter_manager">
      <remap from="~input" to="$(arg RGB_INPUT_CLOUD)" />
      <rosparam>
        use_indices: false
        keep_organized: true
      </rosparam>
      <param name="r_limit_max" value="$(arg r_max)" />
      <param name="r_limit_min" value="$(arg r_min)" />
      <param name="g_limit_max" value="$(arg g_max)" />
      <param name="g_limit_min" value="$(arg g_min)" />
      <param name="b_limit_max" value="$(arg b_max)" />
      <param name="b_limit_min" value="$(arg b_min)" />
    </node>

    <node pkg="nodelet" type="nodelet"
          name="voxelgrid"
          args="standalone pcl/VoxelGrid"
          output="screen" clear_params="true">
      <remap from="~input" to="rgb_color_filter/output" />
      <rosparam>
        leaf_size: 0.01
      </rosparam>
    </node>
    

    <node name="euclidean_clustering"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/EuclideanClustering rgb_filter_manager"
          output="screen">
      <remap from="~input" to="voxelgrid/output" />
      <rosparam>
        tolerance: 0.08 <!-- 0.02 -->
        min_size: 10
      </rosparam>
    </node>

    <node name="cluster_decomposer"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/ClusterPointIndicesDecomposerZAxis rgb_filter_manager"
          output="screen" clear_params="true">
      <remap from="~input" to="voxelgrid/output" />
      <remap from="~target" to="euclidean_clustering/output" />
      <remap from="~debug_output" to="debug_output" />
      <remap from="~boxes" to="boxes" />
      <rosparam>
        align_boxes: True
        align_boxes_with_plane: False
        target_frame_id: BASE
        <!-- publish_tf: True -->
        use_pca: True
        sort_by: cloud_size
        min_size: 10
      </rosparam>
    </node>
  </group>
    
  
  
</launch>
